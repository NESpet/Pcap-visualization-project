{% extends "base.html" %}

{% block navbar %}
				<li><a href="" data-toggle="modal" data-target="#upModal">New Pcap</a></li>
	            <li class="dropdown">
	              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Options<span class="caret"></span></a>
	              <ul class="dropdown-menu">
	                <li><a href="#">Action</a></li>
	                <li><a href="#">Another action</a></li>
	                <li><a href="#">Something else here</a></li>
	                <!-- <li role="separator" class="divider"></li>
	                <li class="dropdown-header">Nav header</li>
	                <li><a href="#">Separated link</a></li>
	                <li><a href="#">One more separated link</a></li> -->
	              </ul>
	            </li>
	            <li><a href="">About</a></li>
{% endblock %}

{% block content %}

		<div id="content" class="container-fluid">
			<div class="row">

			<!-- Flash messages for debug -->
				{% with messages = get_flashed_messages(category_filter="error") %}
		        {% if messages %}
		            <ul>
		            {% for m in messages %}
		                <li>{{ m }}</li>
		            {% endfor %}
		            </ul>
		        {% endif %}
		        {% endwith %}
		    <!-- End flash messages -->

				<div class="left-bar col-md-3">
					<ul id="left-tab" class="nav nav-tabs" role="tablist">
						<li role="presentation" class="active"><a href="#hosts" aria-controls="hosts" role="tab" data-toggle="tab">Hosts</a></li>
						<li role="presentation"><a href="#services" aria-controls="services" role="tab" data-toggle="tab">Services</a></li>
					</ul>
					<div class="tab-content">
						<div id="hosts" role="tabpanel" class="tab-pane active">
						  <table class="table table-striped">
				            <thead>
				              <tr>
				                <th>#</th>
				                <th>Name</th>
				                <th>Exchanged Volume</th>
				              </tr>
				            </thead>
				            <tbody>
				            </tbody>
				          </table>
						</div>
						<div id="services" role="tabpanel" class="tab-pane">
							<table class="table table-striped">
				            <thead>
				              <tr>
				                <th>#</th>
				                <th>Protocol</th>
				                <th>Packets</th>
				                <th><input class="check-all" type="checkbox" value="checkbox"/><button id="refreshButton">Refresh</button></th>
				              </tr>
				            </thead>
				            <tbody>
				            {% for stat in stats | sort(True, attribute="value") %}
				              <tr>
				                <td>{{ loop.index }}</td>
				                <td>{{ stat.name }}</td>
				                <td>{{ stat.value }}</td>
				                <td><input class="check-prot" id="{{ stat.name }}" value="checkbox" type="checkbox"></td>
				              </tr>
				             {% endfor %}
				            </tbody>
				          </table>
						</div>
					</div>
				</div>
				<div class="visu-wrapper col-md-6">

					<button id="parallel-btn" class="btn btn-default" type="button">Parallel</button>
					<button id="treemap-btn" class="btn btn-default" type="button">Treemap</button>
					<div id="view-wrapper" class="panel panel-default">
						<form id="radio-treemap" class="hidden">
						  <label><input type="radio" name="mode" value="size" checked> Size</label>
						  <label><input type="radio" name="mode" value="count"> Count</label>
						</form>
					</div>
				</div>
				<div class="info-wrapper col-md-3">
					<div class="panel panel-default">
						<div class="panel-heading">Info</div>
						<div class="panel-body"></div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-3">	
				</div>
				<div class="packet-wrapper col-md-6">
				    <table class="table table-striped">
		    		    <thead>
			              <tr>
			                <th>SessionId</th>
			                <th>hostSrc</th>
			                <th>portSrc</th>
			                <th>hostDest</th>
			                <th>portDest</th>
			                <th>protocol</th>
			                <th>data</th>
			                <th>timestamp</th>
			              </tr>
			            </thead>
					    <tbody>
			            {% for packet in packets | sort(False, attribute="sessionId") %}
			              <tr>
	                        <td>{{ packet.sessionId }}</td>
			                <td>{{ packet.hostSrc }}  </td>
			                <td>{{ packet.portSrc }}  </td>
			                <td>{{ packet.hostDest }} </td>
			                <td>{{ packet.portDest }} </td>
			                <td>{{ packet.protocol }} </td>

			                {% if packet.data!="" %}
				                <td>
				                  <button type="button" class="btn" data-toggle="collapse" data-target="#demo-{{ packet.id }}">Show Data</button>
				                </td>
				                <td>{{ packet.timestamp }}</td>
				              </tr>
				              <tr class="collapse out" id="demo-{{ packet.id }}">
				                <td colspan="8">
				                  <div class="data">{{ packet.data }}</div>
				                </td>
				              </tr>
							{% else %}
				                <td>
				                  No Data 
				                </td>
				                <td>{{ packet.timestamp }}</td>
				              </tr>
							{% endif %}
			                
			             {% endfor %}
			            </tbody>
		            </table>				
				</div>
				<div class="col-md-3">
				</div>
			</div>
		</div>

{% endblock %}

{% block footer %}
		<!-- Modal -->
		<div class="modal fade" id="upModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="myModalLabel">Upload new Pcap file</h4>
		      </div>
		      <div class="modal-body">
		        <form id="upload-form" action="" method="post" enctype="multipart/form-data">
		        	<div class="form-group">
					    <label for="upPcap">Upload your Pcap</label>
					    <input type="file" id="upPcap" name="upPcap">
					    <p class="help-block">It will be parsed and then displayed.</p>
					</div>
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		        	<button type="submit" class="btn btn-primary">Save changes</button>
		        </form>
		        <br>
		        <progress style="display:none"></progress>
		        <div class="status-container"></div>
		      </div>
		    </div>
		  </div>
		</div>
{% endblock %}

 {% block javascript %}
<script>
	var loadedSessions = [ {% for session in sessions %}{	'id':'{{ session.id }}','hostSrc':'{{ session.hostSrc }}','hostDest':'{{ session.hostDest }}','portSrc':'{{ session.portSrc }}','portDest':'{{ session.portDest }}','protocol':'{{ session.protocol }}'}{% if not loop.last %},{% endif %}{% endfor %} ];
	var loadedUsers = [ {% for user in users %}{ 'id':'{{ user.id }}', 'address':'{{ user.address }}', 'exchanged':{{ user.exchanged | tojson }} }{% if not loop.last %},{% endif %}{% endfor %}];
 	var loadedTreemap = { 'name':'users',	'children': {{ treemap | tojson }} };
 	
 	// var loadedPackets = [ {% for packet in packets %}{ 'id':'{{ packet.id }}','hostSrc':'{{ packet.hostSrc }}','hostDest':'{{ packet.hostDest }}','portSrc':'{{ packet.portSrc }}','portDest':'{{ packet.portDest }}','protocol':'{{ packet.protocol }}','timestamp':'{{ packet.timestamp }}','sessionId':'{{ packet.sessionId }}'}{% if not loop.last %},{% endif %}{% endfor %} ];
</script>
{% endblock %}